<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‚¬ìš©ì ëŒ€ì‹œë³´ë“œ</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding-top: 20px;
            background-color: #f8f9fa;
        }
        .dashboard-header {
            background-color: #007bff;
            color: white;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 5px;
        }
        .summary-card {
            margin-bottom: 20px;
        }
        .section-title {
            margin-top: 40px;
            margin-bottom: 20px;
            font-size: 1.5rem;
            font-weight: 500;
        }
        .table th, .table td {
            vertical-align: middle;
        }
        .chart-placeholder {
            height: 200px;
            background-color: #e9ecef;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .review-item {
            background-color: white;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="dashboard-header text-center">
            <h1><span role="img" aria-label="home">ğŸ </span> ì‚¬ìš©ì ëŒ€ì‹œë³´ë“œ</h1>
        </div>

        <!-- ìš”ì•½ ì¹´ë“œ ì„¹ì…˜ -->
        <div class="row text-center">
            <div class="col-md-4">
                <div class="card summary-card">
                    <div class="card-body">
                        <h5 class="card-title"><span role="img" aria-label="check">âœ”ï¸</span> ì´ ì‘ì‹œ í€´ì¦ˆ ìˆ˜</h5>
                        <p class="card-text display-4" id="totalQuizzes">12</p>
                        <p class="card-text"><small class="text-muted">ì‘ì‹œí•œ í€´ì¦ˆ ìˆ˜</small></p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card summary-card">
                    <div class="card-body">
                        <h5 class="card-title"><span role="img" aria-label="chart">ğŸ“Š</span> í‰ê·  ì ìˆ˜</h5>
                        <p class="card-text display-4" id="averageScore">82ì </p>
                        <p class="card-text"><small class="text-muted">ì „ì²´ í‰ê· </small></p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card summary-card">
                    <div class="card-body">
                        <h5 class="card-title"><span role="img" aria-label="target">ğŸ¯</span> ì •ë‹µë¥ </h5>
                        <p class="card-text display-4" id="correctRate">76%</p>
                        <p class="card-text"><small class="text-muted">ì´ ì •ë‹µ ë¹„ìœ¨</small></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ìµœê·¼ ì‘ì‹œ ê¸°ë¡ ì„¹ì…˜ -->
        <h2 class="section-title"><span role="img" aria-label="calendar">ğŸ“…</span> ìµœê·¼ ì‘ì‹œ ê¸°ë¡</h2>
        <div class="table-responsive">
            <table class="table table-hover table-bordered">
                <thead class="thead-light">
                    <tr>
                        <th>í€´ì¦ˆ ì œëª©</th>
                        <th>ì‘ì‹œ ë‚ ì§œ</th>
                        <th>ì ìˆ˜</th>
                        <th>ì •ë‹µë¥ </th>
                        <th>ë‹¤ì‹œ í’€ê¸°</th>
                    </tr>
                </thead>
                <tbody id="recentAttemptsTable">
                    <!-- ë°ì´í„°ëŠ” JavaScriptë¡œ ì±„ì›Œì§‘ë‹ˆë‹¤. -->
                </tbody>
            </table>
        </div>

        <!-- í€´ì¦ˆ í†µê³„ ì‹œê°í™” ì„¹ì…˜ -->
        <h2 class="section-title"><span role="img" aria-label="stats">ğŸ“Š</span> í€´ì¦ˆ í†µê³„ ì‹œê°í™”</h2>
        <div class="row">
            <div class="col-md-6">
                <div class="chart-placeholder">
                    <p class="text-muted">ğŸ“ˆ ì ìˆ˜ ë³€í™” ì¶”ì´ (Bar Chart)<br>[ Jan ] [ Feb ] [ Mar ] [ Apr ]</p>
                </div>
            </div>
            <div class="col-md-6">
                <div class="chart-placeholder">
                    <p class="text-muted">ğŸ¥§ ì¹´í…Œê³ ë¦¬ë³„ ì„±ê³¼ (Pie Chart)<br>[IT:40%] [ì—­ì‚¬:30%] [ê¸°íƒ€:30%]</p>
                </div>
            </div>
        </div>

        <!-- ì˜¤ë‹µ ë³µìŠµ ì„¹ì…˜ -->
        <h2 class="section-title"><span role="img" aria-label="memo">ğŸ“</span> ì˜¤ë‹µ ë³µìŠµ ì„¹ì…˜</h2>
        <div id="wrongAnswersSection">
            <!-- ë°ì´í„°ëŠ” JavaScriptë¡œ ì±„ì›Œì§‘ë‹ˆë‹¤. -->
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        const totalQuizzesVal = "<%= typeof totalQuizzes !== 'undefined' ? totalQuizzes : 0 %>";
        const averageScoreVal = "<%= typeof averageScore !== 'undefined' ? averageScore : '0' %>";
        const correctRateVal = "<%= typeof correctRate !== 'undefined' ? correctRate : '0' %>";   

        const recentAttemptsData = JSON.parse('<%- JSON.stringify(typeof recentAttempts !== "undefined" ? recentAttempts : []) %>');
        const wrongAnswersData = JSON.parse('<%- JSON.stringify(typeof wrongAnswers !== "undefined" ? wrongAnswers : []) %>');
        const serverError = "<%= typeof error !== 'undefined' ? error : '' %>";

        document.addEventListener('DOMContentLoaded', function () {
            if (serverError) {
                const errorDiv = document.createElement('div');
                errorDiv.classList.add('alert', 'alert-danger');
                errorDiv.textContent = serverError;
                document.querySelector('.container').insertBefore(errorDiv, document.querySelector('.dashboard-header').nextSibling);
            }

            document.getElementById('totalQuizzes').textContent = totalQuizzesVal;
            document.getElementById('averageScore').textContent = averageScoreVal + "ì ";
            document.getElementById('correctRate').textContent = correctRateVal + "%";

            const recentAttemptsTableBody = document.getElementById('recentAttemptsTable');
            recentAttemptsTableBody.innerHTML = ''; 
            if (recentAttemptsData.length > 0) {
                recentAttemptsData.forEach(attempt => {
                    const row = recentAttemptsTableBody.insertRow();
                    row.insertCell().textContent = attempt.quizTitle;
                    row.insertCell().textContent = attempt.attemptDate; 
                    row.insertCell().textContent = attempt.score + "ì  / " + attempt.totalQuestions + "ë¬¸ì œ";
                    row.insertCell().textContent = attempt.rate; 
                    const retryButtonCell = row.insertCell();
                    const button = document.createElement('button');
                    button.classList.add('btn', 'btn-sm', 'btn-outline-primary');
                    button.textContent = 'ë‹¤ì‹œ í’€ê¸°';
                    button.onclick = function() { location.href = `/quiz/list/${attempt.quizId}`; };
                    retryButtonCell.appendChild(button);
                });
            } else {
                const row = recentAttemptsTableBody.insertRow();
                const cell = row.insertCell();
                cell.colSpan = 5;
                cell.textContent = 'ìµœê·¼ ì‘ì‹œ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.';
                cell.classList.add('text-center');
            }

            const wrongAnswersDiv = document.getElementById('wrongAnswersSection');
            wrongAnswersDiv.innerHTML = ''; 
            if (wrongAnswersData.length > 0) {
                wrongAnswersData.forEach(item => {
                    const reviewItemDiv = document.createElement('div');
                    reviewItemDiv.classList.add('review-item');
                    const explanationId = `explanation-${item.quizId}-${item.questionId}`; 
                    reviewItemDiv.innerHTML = `
                        <h5><span role="img" aria-label="cross mark">âŒ</span> ${item.quizTitle} - ${item.questionNumber}ë²ˆ ë¬¸ì œ</h5>
                        <p><strong>Q:</strong> ${item.questionText}</p>
                        <p><strong>ë‚´ ë‹µë³€:</strong> <span class="text-danger">${item.myAnswer}</span> / <strong>ì •ë‹µ:</strong> <span class="text-success">${item.correctAnswer}</span></p>
                        <button class="btn btn-sm btn-info" onclick="toggleExplanation('${explanationId}')">í•´ì„¤ ë³´ê¸°</button>
                        <div id="${explanationId}" style="display:none; margin-top:10px; padding:10px; border:1px solid #eee; background-color:#f9f9f9;">
                            ${item.explanation}
                        </div>
                    `; 
                    wrongAnswersDiv.appendChild(reviewItemDiv);
                });
            } else {
                const noReviewDiv = document.createElement('div');
                noReviewDiv.classList.add('alert', 'alert-light');
                noReviewDiv.textContent = 'ì˜¤ë‹µ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤. ì˜í•˜ì…¨ì–´ìš”!';
                wrongAnswersDiv.appendChild(noReviewDiv);
            }
        });

        function toggleExplanation(elementId) {
            const explanationDiv = document.getElementById(elementId);
            if (explanationDiv) {
                explanationDiv.style.display = explanationDiv.style.display === "none" ? "block" : "none";
            }
        }
    </script>
</body>
</html>
