<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>퀴즈 대시보드</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f5f6fa; font-family: 'Noto Sans KR', sans-serif; }
        .dashboard-container { max-width: 720px; margin: 40px auto; background: #fff; border-radius: 18px; box-shadow: 0 4px 24px rgba(0,0,0,0.10); padding: 40px 36px; }
        h2 { color: #4a3b8c; margin-bottom: 24px; }
        ul { list-style: none; padding: 0; }
        li { font-size: 20px; margin-bottom: 16px; }
        .stat-label { color: #888; margin-right: 8px; }
        .table { background: #fff; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.04); }
        .table th, .table td { vertical-align: middle; text-align: center; font-size: 18px; transition: background 0.2s; }
        .table th { background: #f0f0fa; color: #4a3b8c; font-weight: 700; cursor: pointer; position: relative; }
        .table th[title]:hover::after { content: attr(title); position: absolute; left: 50%; top: 110%; transform: translateX(-50%); background: #333; color: #fff; padding: 4px 10px; border-radius: 6px; font-size: 14px; white-space: nowrap; z-index: 10; }
        .table td[title]:hover::after { content: attr(title); position: absolute; left: 50%; top: 110%; transform: translateX(-50%); background: #333; color: #fff; padding: 4px 10px; border-radius: 6px; font-size: 14px; white-space: nowrap; z-index: 10; }
        .table td.rate-high { background: #e6f9e6; color: #1b7e1b; font-weight: bold; }
        .table td.rate-mid { background: #fffbe6; color: #bfa100; font-weight: bold; }
        .table td.rate-low { background: #ffeaea; color: #d32f2f; font-weight: bold; }
        @media (max-width: 900px) {
            .dashboard-container { max-width: 98vw; padding: 18px 2vw; }
            .table th, .table td { font-size: 15px; }
        }
        @media (max-width: 600px) {
            .dashboard-container { padding: 8px 1vw; }
            .table th, .table td { font-size: 13px; padding: 6px 2px; }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <h2>전체 통계</h2>
        <ul>
            <li><span class="stat-label">응시자 수:</span> <%= stats.total_participants %>명</li>
            <li><span class="stat-label">평균 맞힌 개수:</span> <%= stats.avg_score !== null && stats.avg_score !== undefined ? Number(stats.avg_score).toFixed(2) : 0 %>개</li>
            <li><span class="stat-label">최고 맞힌 개수:</span> <%= stats.max_score !== null && stats.max_score !== undefined ? stats.max_score : 0 %>개</li>
            <li><span class="stat-label">최저 맞힌 개수:</span> <%= stats.min_score !== null && stats.min_score !== undefined ? stats.min_score : 0 %>개</li>
        </ul>
        <hr>
        <h4 style="display: flex; align-items: center; cursor: pointer;" id="toggleStatsBtn">
            문제별 정답률
            <span id="arrowIcon" style="font-size: 1.5rem; margin-left: 8px;">&#9660;</span>
        </h4>
        <div id="questionStatsTable" style="display: none;">
            <table class="table table-bordered mt-3">
                <thead>
                    <tr>
                        <th>문제 내용</th>
                        <th style="white-space:nowrap;">
                            정답률(%)
                            <% if (order === 'rate_desc' || !order) { %>
                                <a href="?order=rate_asc&showStats=1" class="btn btn-link btn-sm fw-bold text-primary">&#9650;</a>
                            <% } else { %>
                                <a href="?order=rate_desc&showStats=1" class="btn btn-link btn-sm fw-bold text-primary">&#9660;</a>
                            <% } %>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <% if (stats.questionStats && stats.questionStats.length > 0) { %>
                        <% stats.questionStats.forEach(function(q, idx) { %>
                            <tr>
                                <td> <%= q.question %> </td>
                                <% let rate = Number(q.correct_rate); %>
                                <% let rateClass = rate >= 70 ? 'rate-high' : (rate >= 40 ? 'rate-mid' : 'rate-low'); %>
                                <td class="<%= rateClass %>"> <%= q.correct_rate %> </td>
                            </tr>
                        <% }); %>
                    <% } else { %>
                        <tr><td colspan="2">문제별 정답률 데이터가 없습니다.</td></tr>
                    <% } %>
                </tbody>
            </table>
        </div>
        <script>
            const toggleBtn = document.getElementById('toggleStatsBtn');
            const statsTable = document.getElementById('questionStatsTable');
            const arrowIcon = document.getElementById('arrowIcon');
            toggleBtn.addEventListener('click', function() {
                if (statsTable.style.display === 'none') {
                    statsTable.style.display = 'block';
                    arrowIcon.innerHTML = '&#9650;'; // 위쪽 화살표
                } else {
                    statsTable.style.display = 'none';
                    arrowIcon.innerHTML = '&#9660;'; // 아래쪽 화살표
                }
            });
            // 쿼리스트링 showStats=1이 있으면 자동으로 펼침
            window.addEventListener('DOMContentLoaded', function() {
                const params = new URLSearchParams(window.location.search);
                if (params.get('showStats') === '1') {
                    statsTable.style.display = 'block';
                    arrowIcon.innerHTML = '▲';
                }
            });
        </script>
        <a href="/quiz/final-result" class="btn btn-primary mt-3">결과 페이지로 돌아가기</a>
        <a href="/" class="btn btn-secondary mt-3">홈으로</a>
    </div>
</body>
</html> 